<!DOCTYPE html>
<html>
<!-- -->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="product.css" />
</head>

<body>
    <div id="load">
        <img src="img/loding.gif" alt="loading">
    </div>

    <div class="box">
        <div class="img-page">
            <header class="header">
                <div class="header_dates">
                    <div class="header_year"><span id="year">2024</span></div>
                    <div class="header_month_num"><span id="month">1</span></div>
                    <div class="header_month_string"> <span id="smonth">january</span></div>
                </div>
                <div class="headerbar">
                    <img class="menuimg" src="/app/Front/img/person_FILL0_wght400_GRAD0_opsz24.png"
                        onclick="toggleSidebar()" />

                    <!-- 사이드 메뉴 항목들 -->
                    <div id="sidebar" class="sidebar">
                        <div class="sidebar_header">
                            <div class="sidebar_header_contents">
                                <img class="sidebar_img" src="/app/Front/img/ellipse-30.png" />
                                <!-- <img class="sidebar_img" src="${pageContext.request.contextPath}/resources/img/ellipse-30.png" /> -->
                                <p class="userNickName"></p>
                            </div>
                        </div>
                        <div class="sidebar_main">
                            <div class="setting_theme">
                                <img src="img/next.png" class="toggle_button" onclick="toggleDropdown(this)">
                                <p>테마 설정
                                <p>
                                    <!-- <img src="${pageContext.request.contextPath}/resources/img/next.png" class="toggle_button" onclick="toggleDropdown(this)"> -->
                                <div class="dropdown_menu">
                                    <p>Theme Option 1</p>
                                    <p>Theme Option 2</p>
                                    <p>Theme Option 2</p>
                                </div>
                            </div>
                            <div class="setting_font">
                                <img src="/app/Front/img/next.png" class="toggle_button" onclick="toggleDropdown(this)">
                                <p>폰트 설정</p>
                                <!-- <img src="${pageContext.request.contextPath}/resources/img/next.png" class="toggle_button" onclick="toggleDropdown(this)"> -->
                                <div class="dropdown_menu">
                                    <p>Theme Option 1</p>
                                    <p>Theme Option 2</p>
                                    <p>Theme Option 2</p>
                                </div>
                            </div>
                            <div class="setting_alarm">
                                <img src="/app/Front/img/next.png" class="toggle_button" onclick="toggleDropdown(this)">
                                <p>알림 설정</p>
                                <!-- <img src="${pageContext.request.contextPath}/resources/img/next.png" class="toggle_button" onclick="toggleDropdown(this)"> -->
                                <div class="dropdown_menu">
                                    <p>Alarm Option 1</p>
                                    <p>Alarm Option 2</p>
                                    <p>Alarm Option 2</p>
                                </div>
                            </div>
                            <div class="setting_account">
                                <img src="/app/Front/img/next.png" class="toggle_button" onclick="toggleDropdown(this)">
                                <p>계정 설정</p>
                                <!-- <img src="${pageContext.request.contextPath}/resources/img/next.png" class="toggle_button" onclick="toggleDropdown(this)"> -->
                                <div class="dropdown_menu">
                                    <p>Account Option 1</p>
                                    <p>Account Option 2</p>
                                </div>
                            </div>
                        </div>
                        <div class="sidebar_footer">
                            <button class="sign_out" onclick="signout_button()">Sign out</button>
                        </div>
                    </div>
                    <div class="back-main" onclick="main_button()">CBY.com</div>
                </div>
            </header>
            <main class="img-box">
                <div class="days"><span id="day">28 (일)</span></div>
                <!-- <img class="backpage" onclick="back_button()" src="img/back.png" /> questionpage로 돌아가는 함수(비활성화 삭제예정) -->

                <div class="Qbox">
                    <div class="five" id="QnA">
                        <div class="AI-question">
                            <p class="Q">Q5:</p>
                            <p class="Q5" id="question5"></p>
                        </div>
                        <div class="User-answer">
                            <p class="Q">A:</p>
                            <p class="A5" id="answer5" maxlength="300"></p>
                        </div>
                        <div class="NnB">
                            <div class="back"></div>
                            <div class="next"></div>
                        </div>
                    </div>
                    <div class="four" id="QnA">
                        <div class="AI-question">
                            <p class="Q">Q4:</p>
                            <p class="Q4" id="question4"></p>
                        </div>
                        <div class="User-answer">
                            <p class="Q">A:</p>
                            <p class="A4" id="answer4" maxlength="300"></p>
                        </div>
                        <div class="NnB">
                            <div class="back"></div>
                            <div class="next"></div>
                        </div>
                    </div>
                    <div class="three" id="QnA">
                        <div class="AI-question">
                            <p class="Q">Q3:</p>
                            <p class="Q3" id="question3"></p>
                        </div>
                        <div class="User-answer">
                            <p class="Q">A:</p>
                            <p class="A3" id="answer3" maxlength="300"></p>
                        </div>
                        <div class="NnB">
                            <div class="back"></div>
                            <div class="next"></div>
                        </div>
                    </div>
                    <div class="two" id="QnA">
                        <div class="AI-question">
                            <p class="Q">Q2:</p>
                            <p class="Q2" id="question2"></p>
                        </div>
                        <div class="User-answer">
                            <p class="Q">A:</p>
                            <p class="A2" id="answer2" maxlength="300"></p>
                        </div>
                        <div class="NnB">
                            <div class="back"></div>
                            <div class="next"></div>
                        </div>
                    </div>
                    <div class="one" id="QnA">
                        <div class="AI-question">
                            <p class="Q">Q1:</p>
                            <p class="Q1" id="question"></p>
                        </div>
                        <div class="User-answer">
                            <p class="Q">A:</p>
                            <p class="A1" id="answer" maxlength="300"></p>
                        </div>
                        <div class="NnB">
                            <div class="back"></div>
                            <div class="next"></div>
                        </div>
                    </div>
                </div>

                <img class="img" src="" id="img" />
                <div class="save-box" id="saveButton"><img class="save" src="img/save.png" /></div>
            </main>
            <div id="sidebar" class="sidebar">
                <!-- 메뉴 항목들 -->
                <form action="/member/update">
                    <div class="menu-item"><button onclick="">userUdate</button></div>
                </form>
                <form action="/app/Front/sign/sign-in.html">
                    <div class="menu-item"><button onclick="">userLogout</button></div>
                </form>
                <div class="menu-item"><button onclick="">내정보</button></div>
            </div>

        </div>
    </div>
    <div id="overlay" class="overlay" onclick="closeSidebar()"></div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // 사이드바 함수
        const toggleSidebar = () => {
            let sidebar = document.getElementById("sidebar");
            let overlay = document.getElementById("overlay");
            sidebar.classList.toggle("active");
            overlay.classList.toggle("active");
        };

        const closeSidebar = () => {
            let sidebar = document.getElementById("sidebar");
            let overlay = document.getElementById("overlay");
            sidebar.classList.remove("active");
            overlay.classList.remove("active");
        };

        // 드롭다운 토글 함수
        const toggleDropdown = (element) => {
            const parent = element.closest('.setting_theme, .setting_font, .setting_alarm, .setting_account');
            const dropdown = parent.querySelector('.dropdown_menu');
            if (dropdown) {
                dropdown.classList.toggle('show');
            } else {
                const newDropdown = document.createElement('div');
                newDropdown.classList.add('dropdown_menu', 'show');
                newDropdown.innerHTML = '<p>Option 1</p><p>Option 2</p>';
                parent.appendChild(newDropdown);
            }
            element.classList.toggle('rotate');
        };

        $(document).ready(function () {
            let rerollCount = 1;

            $('.reroll-box').hover(
                function () {
                    $('#reroll-counter').text(rerollCount); // hover 시 숫자를 업데이트
                }
            );

            $('.reroll-box').on('click', function () {
                if (rerollCount > 0) {
                    rerollCount--;
                    $('#reroll-counter').text(rerollCount); // 클릭 시 숫자를 업데이트
                }
            });
            let lastWheelEventTime = 0;
            const wheelEventCooldown = 1000; // 1000ms (1초) 동안 이벤트 무시
            // 초기 활성 요소를 'one'으로 설정
            $('.Qbox > .one').addClass('active');

            // 'wheel' 이벤트 핸들러를 설정
            $('.Qbox').on('wheel', function (event) {
                const currentTime = new Date().getTime();
                // 마지막 이벤트 발생 이후로 충분한 시간이 경과하지 않았으면 리턴
                if (currentTime - lastWheelEventTime < wheelEventCooldown) {
                    return;
                }
                lastWheelEventTime = currentTime;

                // deltaY 값을 가져와서 스크롤 방향을 결정
                const deltaY = event.originalEvent.deltaY;

                // 현재 활성 요소의 인덱스를 가져옵니다.
                let activeIndex = $('.Qbox > .active').index();

                // 아래로 스크롤하고 이전 요소가 있는 경우
                if (deltaY > 0 && activeIndex > 0) {
                    // 이전 요소로 활성 클래스를 옮기고 zIndex를 업데이트
                    $('.Qbox > div').eq(activeIndex - 1).addClass('active').css('z-index', 1);
                    $('.Qbox > div').eq(activeIndex).removeClass('active').css('z-index', 0);
                }
                // 위로 스크롤하고 다음 요소가 있는 경우
                else if (deltaY < 0 && activeIndex < 4) {
                    // 다음 요소로 활성 클래스를 옮기고 zIndex를 업데이트
                    $('.Qbox > div').eq(activeIndex + 1).addClass('active').css('z-index', 1);
                    $('.Qbox > div').eq(activeIndex).removeClass('active').css('z-index', 0);
                }
                else {
                    // 마지막 요소인 경우 첫 번째 요소로 돌아갑니다.
                    $('.Qbox > div').eq(4).addClass('active').css('z-index', 1);
                    $('.Qbox > div').eq(0).removeClass('active').css('z-index', 0);
                }
            });
            // 'next' 클릭 이벤트 핸들러를 설정
            $('.next').on('click', function () {
                const currentTime = new Date().getTime();
                // 마지막 이벤트 발생 이후로 충분한 시간이 경과하지 않았으면 리턴
                if (currentTime - lastWheelEventTime < wheelEventCooldown) {
                    return;
                }
                lastWheelEventTime = currentTime;
                // 현재 활성 요소의 인덱스를 가져옵니다.
                let activeIndex = $('.Qbox > .active').index();

                // 현재 활성 요소가 첫 번째 요소가 아닌 경우
                if (activeIndex > 0) {
                    // 이전 요소로 활성 클래스를 옮기고 zIndex를 업데이트
                    $('.Qbox > div').eq(activeIndex - 1).addClass('active').css('z-index', 1);
                    $('.Qbox > div').eq(activeIndex).removeClass('active').css('z-index', 0);
                }
                else {
                    // 마지막 요소인 경우 첫 번째 요소로 돌아갑니다.
                    $('.Qbox > div').eq(4).addClass('active').css('z-index', 1);
                    $('.Qbox > div').eq(0).removeClass('active').css('z-index', 0);
                }
            });

            // 'back' 클릭 이벤트 핸들러를 설정
            $('.back').on('click', function () {
                const currentTime = new Date().getTime();
                // 마지막 이벤트 발생 이후로 충분한 시간이 경과하지 않았으면 리턴
                if (currentTime - lastWheelEventTime < wheelEventCooldown) {
                    return;
                }
                lastWheelEventTime = currentTime;
                // 현재 활성 요소의 인덱스를 가져옵니다.
                let activeIndex = $('.Qbox > .active').index();

                // 현재 활성 요소가 마지막 요소가 아닌 경우
                if (activeIndex < 4) {
                    // 다음 요소로 활성 클래스를 옮기고 zIndex를 업데이트
                    $('.Qbox > div').eq(activeIndex + 1).addClass('active').css('z-index', 1);
                    $('.Qbox > div').eq(activeIndex).removeClass('active').css('z-index', 0);
                }
                else {
                    // 마지막 요소인 경우 첫 번째 요소로 돌아갑니다.
                    $('.Qbox > div').eq(0).addClass('active').css('z-index', 1);
                    $('.Qbox > div').eq(4).removeClass('active').css('z-index', 0);
                }

            });
            function displayDataFromQueryString() {
                // 현재 URL에서 query string을 가져옴
                const queryString = window.location.search.substring(1);

                // query string을 파싱하여 객체로 변환
                const params = new URLSearchParams(queryString);

                // 각 질문과 답변을 받아옴
                const question1 = params.get('question1');
                const answer1 = params.get('answer1');
                const question2 = params.get('question2');
                const answer2 = params.get('answer2');
                const question3 = params.get('question3');
                const answer3 = params.get('answer3');
                const question4 = params.get('question4');
                const answer4 = params.get('answer4');
                const question5 = params.get('question5');
                const answer5 = params.get('answer5');

                // 각 질문과 답변을 HTML에 적용
                $('.five #question5').text(question5);
                $('.five #answer5').text(answer5);

                $('.four #question4').text(question4);
                $('.four #answer4').text(answer4);

                $('.three #question3').text(question3);
                $('.three #answer3').text(answer3);

                $('.two #question2').text(question2);
                $('.two #answer2').text(answer2);

                $('.one #question').text(question1);
                $('.one #answer').text(answer1);
            }

            // 페이지 로딩 시 데이터 출력 함수 호출
            displayDataFromQueryString();

            createImg();
        });
        function createImg() {
            // 이미지 파일 또는 이미지 데이터를 변수에 할당
            // const imgSrc = `http://13.125.46.32:5001/get_image`; // 초기 이미지를 불러올 URL

            // const imgData = {
            //     userEmail: 'test2@test2.com',
            //     created_at: '2024-06-16',
            //     img: imgSrc // 이미지 URL을 전송할 데이터에 추가합니다.
            // };

            // 서버로 데이터를 전송합니다.
            fetch(`http://13.125.46.32:5001/get_image?userEmail = `, {
                method: 'get',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(imgData) // JSON 형태로 데이터 전송
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json(); // 서버에서 반환된 JSON 데이터를 처리
                })
                .then(data => {
                    console.log('이미지 업로드 성공:', data);

                    // 서버에서 받은 이미지 URL을 사용하여 이미지 엘리먼트의 src 속성 설정
                    document.getElementById('img').src = data.imgUrl;

                    // 성공적으로 이미지가 업로드되었을 때 처리할 작업 추가
                })
                .catch(error => {
                    console.error('이미지 업로드 오류:', error);
                });
        }


        // 페이지가 로드될 때 createImg 함수를 호출합니다.
        window.onload = function () {
            createImg();
        };

        function autoTransition() {
            // 현재 활성 요소의 인덱스를 가져옵니다.
            let activeIndex = $('.Qbox > .active').index();

            // 현재 활성 요소가 마지막 요소가 아닌 경우
            if (activeIndex > 0) {
                // 다음 요소로 활성 클래스를 옮기고 zIndex를 업데이트
                $('.Qbox > div').eq(activeIndex - 1).addClass('active').css('z-index', 1);
                $('.Qbox > div').eq(activeIndex).removeClass('active').css('z-index', 0);
            }
            else {
                // 마지막 요소인 경우 첫 번째 요소로 돌아갑니다.
                $('.Qbox > div').eq(4).addClass('active').css('z-index', 1);
                $('.Qbox > div').eq(0).removeClass('active').css('z-index', 0);
            }
        }

        // 일정 시간마다 autoTransition 함수 호출
        setInterval(autoTransition, 10000); // 10000ms = 10초

        // 현재 날짜, 시간 가져오기
        let date = new Date();
        // 연도, 월, 월 이름, 일 요소 가져오기
        const $year = document.querySelector("#year");
        const $month = document.querySelector("#month");
        const $smonth = document.querySelector("#smonth");
        const $day = document.querySelector("#day");

        // 현재 연도를 연도 요소에 설정
        $year.textContent = date.getFullYear();

        // 현재 월을 월 요소에 설정
        $month.textContent = date.getMonth() + 1; // Adding 1 to make it 1-indexed

        // 월 이름 배열을 정의합니다.
        const monthNames = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        // 현재 월의 인덱스를 가져와서 해당 월 이름을 월 이름 요소에 설정
        let monthIndex = date.getMonth();
        let monthName = monthNames[monthIndex];
        $smonth.textContent = monthName;

        // 요일 이름 배열을 정의
        const weekdayNames = [
            "일", "월", "화", "수", "목", "금", "토"
        ];

        // 현재 요일의 인덱스를 가져와서 해당 요일 이름과 날짜를 일 요소에 설정
        let weekdayIndex = date.getDay();
        let weekdayName = weekdayNames[weekdayIndex];
        let day = date.getDate();
        //textCpmtemt로 현재 요일과 날짜 출력
        $day.textContent = `${day} (${weekdayName})`;


        $('#saveButton').on('click', function () {
            const mainurl = "http://127.0.0.1:5501/app/Front/main_dev/Main.html";

            window.location.href = mainurl;
        });
        //메인으로 가는 버튼
        const main_button = () => {
            url = "http://127.0.0.1:5500/app/Front/main_dev/Main.html";
            window.location.href = url;
        };
        const loading_page = document.getElementById("load");
        window.onload = function () {
            loading_page.style.display = 'none';
        }
        //뒤로가기를 막는 함수
        history.pushState(null, null, location.href);
        window.onpopstate = function (event) {
            history.forward();
        };
        //새로고침을 막는 함수
        function doNotReload() {
            if ((event.ctrlKey == true && (event.keyCode == 78 || event.keyCode == 82)) //ctrl+N , ctrl+R
                || (event.keyCode == 116)) {
                event.keyCode = 0;
                event.cancelBubble = true;
                event.returnValue = false;
            }
        }
        document.onkeydown = doNotReload;
    </script>
</body>

</html>