<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="gallery.css" />
    <title>Welcome CBY Project</title>
</head>

<body>
    <div class="overlay"></div>
    <main class="container disabled">
        <div class="side_lamp">
            <div class="left_lamp">
                <button class="lamp_toggle"> <img src="img/lamp_off.png" class="lamp_toggle_img"></button>
                <div class="light"></div>
            </div>
        </div>
        <div class="gallery">
            <div class="gallery_group">
                <div class="bookcase">
                    <h1>2024</h1>
                    <div class="book">
                        <p>January</p>
                    </div>
                </div>
                <div class="bookcase">
                    <h1>2024</h1>
                    <div class="book">
                        <p>January</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="side_lamp">
            <div class="right_lamp">
                <button class="lamp_toggle"><img src="img/lamp_off.png" class="lamp_toggle_img"></button>
                <div class="light"></div>
            </div>
        </div>
    </main>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const galleryGroup = document.querySelector(".gallery_group");
            const overlay = document.querySelector(".overlay");
            const container = document.querySelector(".container");
            const lampToggles = document.querySelectorAll(".lamp_toggle");
            const bookDetailOverlay = document.querySelector(".book-detail-overlay");
            const bookDetailContent = document.querySelector(".book-content");
            const closeDetailBtn = document.querySelector(".close-detail");
            let lampStatus = [false, false];

            // 어둡고 비활성화된 상태로 초기화
            overlay.style.display = "block";
            container.classList.add("disabled");

            lampToggles.forEach((button, index) => {
                button.addEventListener("click", () => {
                    const img = button.querySelector(".lamp_toggle_img");
                    lampStatus[index] = !lampStatus[index];

                    if (img.src.includes("lamp_off.png")) {
                        img.src = "img/lamp_on.png";
                    } else {
                        img.src = "img/lamp_off.png";
                    }

                    if (lampStatus.every(status => status)) {
                        // 모든 램프가 켜졌을 때
                        overlay.style.display = "none";
                        container.classList.remove("disabled");
                    } else if (lampStatus.every(status => !status)) {
                        // 모든 램프가 꺼졌을 때
                        overlay.style.display = "block";
                        container.classList.add("disabled");
                    }
                });
            });

            // 책 클릭 이벤트 핸들러 추가
            document.querySelectorAll('.book').forEach(book => {
                book.addEventListener('click', () => {
                    bookDetailContent.textContent = book.querySelector('p').textContent;
                    bookDetailOverlay.style.display = 'flex';
                });
            });

            closeDetailBtn.addEventListener('click', () => {
                bookDetailOverlay.style.display = 'none';
            });

            let isDown = false;
            let startY;
            let scrollTop;

            galleryGroup.addEventListener("mousedown", (e) => {
                if (container.classList.contains("disabled")) return;
                isDown = true;
                startY = e.pageY - galleryGroup.offsetTop;
                scrollTop = galleryGroup.scrollTop;
                galleryGroup.style.cursor = "grabbing";
            });

            galleryGroup.addEventListener("mouseleave", () => {
                isDown = false;
                galleryGroup.style.cursor = "grab";
            });

            galleryGroup.addEventListener("mouseup", () => {
                isDown = false;
                galleryGroup.style.cursor = "grab";
            });

            galleryGroup.addEventListener("mousemove", (e) => {
                if (!isDown) return;
                e.preventDefault();
                const y = e.pageY - galleryGroup.offsetTop;
                const walk = (y - startY) * 1;
                galleryGroup.scrollTop = scrollTop - walk;
            });

            galleryGroup.addEventListener("wheel", (e) => {
                if (container.classList.contains("disabled")) return;
                e.preventDefault();
                galleryGroup.scrollTop += e.deltaY;
            });
        });

    </script>
</body>

</html>